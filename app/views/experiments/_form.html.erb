<% form_for experiment, :html => {:multipart => true} do |f| %>
  <% #TODO: convert experiment form to semantic form %>
  <div class="form_item">
  	<h3>Metadata</h3>
  	Choose a unique name for your experiment. Try to keep it concise.<br/>
  	<%= f.text_field :name, :size => 25%>
  	<br/><br/>
  	Which group will be able to view this data.<br/>
  	<%= f.collection_select :group_id, Group.accessible_by(current_ability), :id, :name %><br/>
  	<br/>
  	Enter any descriptive information you would like to remember.<br/>
  	<%= f.text_area :description, :rows => "7" %><br/>
  	<%= render :partial => "metadata", :locals => {:f => f} rescue nil%>
  </div>

  <div class="form_item">
    <h3>Sequence Data</h3>
    <div style="float:left">
      Assembly<br/>
      <%= f.collection_select :assembly_id, @assemblies, :id, :name_with_version,{},
        {'data-onchange' => concordance_sets_assemblies_url, :'data-params' => "exp_type=#{experiment.class.name.underscore}",:'data-with' => :assembly_id, :'data-element' => :concordance_selection}
      %><br/>
      <br/>
      Concordance Set<br/>
      <div id='concordance_selection'>
        <%= render :partial => "assemblies/concordance_set_selection", 
          :locals => {:exp_type => experiment.class.name.underscore, :concordance_sets => (experiment.assembly||@assemblies.first).concordance_sets} 
        %>
      </div>
      <br/>
    </div>  
  </div>

  <div class="form_item">
    <%= render :partial => "form_options", :locals => {:f => f} rescue nil%>
  </div>

  <div class="form_item">
    	<h3 style="float:left;width:8em">Asset File(s)</h3>
    	<%= link_to_add_fields image_tag("add.gif", :title => "Add another File", :style => "float:left"),
    	  f, 
    	  :assets,
    	  {:render => "below",:partial => "experiments/asset_fields", :locals => {:asset_types => experiment.asset_types} }
    	%>
    	<% f.fields_for :assets do |asset| %>
  	    <%= 
  	    #FIXME: rescue in view has a bad smell
  	      begin
  	        render :partial => "asset_fields", :locals => {:f => asset}
  	      rescue 
  	        render :partial => "experiments/asset_fields",
  	        :locals => {:asset_types => experiment.asset_types,:f => asset}
  	      end
  	    %>
  	  <% end %>
  </div>

  <div style="clear:both">
  	<br/><hr/><br/><br/>
  	<%= f.submit "Save Experiment" %>
  </div>
  	
<% end %>
  