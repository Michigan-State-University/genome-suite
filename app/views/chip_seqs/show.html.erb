<%= render :partial => "experiments/show", :locals => {:experiment => @chip_seq} %>

<script type='text/javascript'>
////Ext multi-series graph needs to allow binding multiple Stores.
// Ext.onReady(function(){
// 	Ext.define('LinePoint', {
// 	    extend: 'Ext.data.Model',
// 	    fields: [
// 	        {name: 'linex', type: 'int'},
// 	        {name: 'liney',  type: 'float'},
// 	        {name: 'pointx', type: 'int'},
// 	        {name: 'pointy',  type: 'float'}
// 	    ]
// 	});
// 	var myStore = Ext.create('Ext.data.Store', {
// 	    model: 'LinePoint',
// 	    proxy: {
// 	        type: 'ajax',
// 	        url : '<%= "#{@chip_seq.id}.xml" %>',
// 	        reader: {
// 	            type: 'xml',
// 	            root: 'linedata',
// 							model: 'LinePoint',
// 							record: 'linepoint'
// 	        }
// 	    },
// 	    autoLoad: true
// 	});
// 	var peakStore = Ext.create('Ext.data.Store', {
// 	    model: 'LinePoint',
// 	    proxy: {
// 	        type: 'ajax',
// 	        url : '<%= "#{@chip_seq.id}.xml?peaks=true" %>',
// 	        reader: {
// 	            type: 'xml',
// 	            root: 'peakdata',
// 							model: 'LinePoint',
// 							record: 'linepoint'
// 	        }
// 	    },
// 	    autoLoad: true
// 	});
// 	var lineChart = Ext.create('Ext.chart.Chart', {
// 	    renderTo: 'exp_chart',
// 	    width: 750,
// 	    height: 400,
// 	    //animate: true,
// 	    store: myStore,
// 	    shadow: true,
// 	    theme: 'Sky',
// 	    axes: [{
// 	        type: 'Numeric',
// 	        minimum: 0,
// 	        position: 'left',
// 	        fields: ['liney','pointy'],
// 	        title: 'Density',
// 					grid: {
// 			        odd: {
// 			            opacity: 1,
// 			            fill: '#eee',
// 			            stroke: '#ccc',
// 			            'stroke-width': 1
// 			        }
// 			    }
// 	    }, {
// 	        type: 'Numeric',
// 	        position: 'bottom',
// 					minimum: 0,
// 	        fields: ['linex','pointx'],
// 	        title: 'Position'
// 	    }],
// 	    series: [
// 				{
// 	        type: 'line',
// 	        axis: 'left',
// 	        fill: true,
// 					smooth: true,
// 	        xField: 'linex',
// 	        yField: 'liney',
// 	        showMarkers: false
// 	    }]
// 	});
// 	var peakChart = Ext.create('Ext.chart.Chart', {
// 	    renderTo: 'exp_chart',
// 			style:'position:absolute;',
// 	    width: 750,
// 	    height: 400,
// 			hidden: true,
// 	    animate: true,
// 	    store: peakStore,
// 	    shadow: true,
// 	    theme: 'Sky',
// 	    axes: [{
// 	        type: 'Numeric',
// 	        minimum: 0,
// 	        position: 'left',
// 	        fields: ['liney','pointy'],
// 	        title: 'Density',
// 					grid: {odd: {opacity: 0},even: {opacity:0}}
// 	    }, {
// 	        type: 'Numeric',
// 	        position: 'bottom',
// 					minimum: 0,
// 	        fields: ['linex','pointx'],
// 	        title: 'Position'
// 	    }],
// 	    // Add two line series
// 	    series: [{
// 	      type: 'scatter',
// 	      axis: 'left',
// 	      xField: 'pointx',
// 	      yField: 'pointy',
// 				highlight: {
//             fill: '#ddf',
// 						opacity: .5,
//             radius: 10,
//             lineWidth: 5,
//             stroke: '#55f'
//         },
// 				tips: {
// 					trackMouse: true,
// 					renderer: function(storeItem, item) {
// 						this.setTitle('Peak');
// 						val = Ext.util.Format.number(storeItem.get('pointy'),'0,0.00');
// 						pos = Ext.util.Format.number(storeItem.get('pointx'),'0,0');
// 						this.update('Value: '+val+'<br/>Position: '+pos);
// 					}
// 				},
// 		  }]
// 	});
// 	
// 	//TODO FIX: dirty hack. Can't have multiple stores for chart, so we draw two charts and overlay them
// 	lineChart.store.on('load',function(){peakChart.setPosition(lineChart.getPosition());})
// 	window.onresize = function(){
// 		peakChart.setPosition(lineChart.getPosition());
// 	}
// 	$('show_peaks').onchange = function(){
// 		if(this.checked)
// 			peakChart.show();
// 		else
// 			peakChart.hide();
// 	}	
// 	
// });
// 
// 
</script>

